name: Branch Protection

# This workflow enforces branch protection rules for the main branch
# Only the repository owner can push directly to main
#
# IMPORTANT: This workflow runs AFTER a push occurs, so it cannot prevent
# unauthorized code from being pushed. It fails the workflow to alert the owner
# and can be used as a required status check. For complete protection, configure
# GitHub branch protection settings in Settings → Branches (see BRANCH_PROTECTION.md)

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  validate:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    
    steps:
      - name: Validate access
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            [ "${{ github.actor }}" = "${{ github.repository_owner }}" ] || {
              echo "❌ Only @${{ github.repository_owner }} can push to main"
              exit 1
            }
          fi
          echo "✅ Validation passed"
