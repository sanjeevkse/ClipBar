name: Branch Protection

# This workflow enforces branch protection rules for the main branch
# Only the repository owner can push directly to main
#
# IMPORTANT: This workflow runs AFTER a push occurs, so it cannot prevent
# unauthorized code from being pushed. It fails the workflow to alert the owner
# and can be used as a required status check. For complete protection, configure
# GitHub branch protection settings in Settings â†’ Branches (see BRANCH_PROTECTION.md)

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  check-push-permission:
    # This job runs on direct pushes to main branch
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
      - name: Check if push is from repository owner
        run: |
          PUSHER="${{ github.actor }}"
          OWNER="${{ github.repository_owner }}"
          
          echo "Push attempt by: $PUSHER"
          echo "Repository owner: $OWNER"
          
          if [ "$PUSHER" != "$OWNER" ]; then
            echo "âŒ ERROR: Only @$OWNER can push directly to the main branch."
            echo "Please create a pull request instead."
            exit 1
          else
            echo "âœ… Push authorized: Repository owner"
          fi

  validate-pull-request:
    # This job runs on pull requests to main branch
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    
    steps:
      - name: Validate PR requirements
        run: |
          echo "ğŸ“‹ Pull Request Validation"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "PR #${{ github.event.pull_request.number }}"
          echo "Author: ${{ github.actor }}"
          echo "Target: ${{ github.event.pull_request.base.ref }}"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "âš ï¸  Required before merge:"
          echo "  â€¢ Approval from @${{ github.repository_owner }} (Code Owner)"
          echo "  â€¢ All status checks must pass"
          echo "  â€¢ No merge conflicts"
          echo ""
          echo "âœ… Pull request validation completed."
